<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <meta name="viewport" content="width=device-width">
    <link rel="icon" type="image/png" href="/images/cabin.png">
    <link href="/styles/main.css" rel="stylesheet">
    <title>cyberskunk's Blog</title>
  </head>
  <body>
    <nav id="nav">
      <h1 class="name"><a href="/">cyberskunk</a></h1>
      <ul class="nav-links">
        <li class="menu-in menu"><a href="#nav" class="icon-menu"></a></li>
        <li class="menu-out menu"><a href="#" class="icon-menu"></a></li>
        <li><a href="/about.html">about</a></li>
        <li><a href="/archives.html">archives</a></li>
      </ul>
      <div class="social-media"><a href="https://github.com/cy6erskunk" class="icon-github"></a><a href="https://twitter.com/cyberskunk" class="icon-twitter"></a></div>
    </nav>
    <div class="content">
      <div class="post-head group"><a href="/blog/posts/strange-issues-with-x-ua-compatible.html">
          <h1 class="post-title">Strange issues with X-UA-Compatible</h1></a>
        <h2 class="post-date">2014 &#183; 5 &#183; 30</h2>
      </div>
      <div class="post-body"><a name="x-ua-compatible--no----...." class="anchor" href="#x-ua-compatible--no----...."><h2>X-UA-Compatible? NO!!!!....</h2>
</a><p>There is quite simple way to tell IE to switch to older version compatibility mode - it
is META tag (or header). MSDN describes this approach in the following
<a href="http://msdn.microsoft.com/en-us/library/jj676915(v=vs.85).aspx">article</a></p>
<p>There is a way to specify multiple content attribute values, described in corresponding section of the document.</p>
<p>However there is some strange issue with IE8: if we add</p>
<pre><code><div class="highlight"><pre><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;x-ua-compatible&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;IE=7,edge&quot;</span><span class="o">/&gt;</span>
</pre></div>
</code></pre>
<p>or</p>
<pre><code><div class="highlight"><pre><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;x-ua-compatible&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;IE=7,IE=edge&quot;</span><span class="o">/&gt;</span>
</pre></div>
</code></pre>
<p>into the <code>&lt;head&gt;</code> of the page, IE8 switches to IE7 mode but more recent versions of IE do not switch to compatibility mode.</p>
<p>This behaviour is a bit strange, because IE8 could use <code>edge</code> value and act as IE8, but...</p>
<p>That&#39;s not all! </p>
<p>If we change <code>IE=7</code> to <code>IE=8</code>, none of IE8+ browsers switch to compatibility mode. Hmmm...</p>
<p>It leads us to the following idea: IE8 does not understand several values and uses the very first one instead (<code>&lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;IE=6,7,edge&quot;/&gt;</code> switches IE8 in quirks mode, as if <code>&lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;IE=6&quot;/&gt;</code> was provided). </p>
</div>
      <div class="post-head group"><a href="/blog/posts/js-closures-memory-optimization.html">
          <h1 class="post-title">JavaScript closures memory optimization - unused variables</h1></a>
        <h2 class="post-date">2013 &#183; 8 &#183; 22</h2>
      </div>
      <div class="post-body"><p>Есть интересная особенность у Chrome и Firefox (возможно, в других браузерах тоже): переменные из родительского контекста, которые не используются в функции, выпиливаются из замыкания. То есть, если в следующем коде:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
    <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// &lt;-- put breakpoint on this line</span>
    <span class="p">})();</span>
<span class="p">})();</span>
</pre></div>
</code></pre>
<p>поставить breakpoint на строке, где объявляется <code>bar</code>, и в момент остановки попробовать получить значение <code>foo</code>, то мы получим <code>ReferenceError: foo is not defined</code>. При этом, следующий код прекрасно отработает, как следовало ожидать:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
    <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// &lt;-- put breakpoint on this line</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span>
    <span class="p">})();</span>
<span class="p">})();</span>
</pre></div>
</code></pre>
<p>и <code>foo</code> вполне себе бует доступна во вложенной функции.</p>
<p>Делается это, по всей видимости, для того, чтобы не захламлять память ненужными данными. И никаких проблем вызывать не должно, но, как оказалось, может приводить к неожиданностям при дебаггинге.</p>
<p>Наблюдали это поведение в Chromium 25 и Firefox 22, но, если верить <a href="http://stackoverflow.com/questions/15801471/deeper-understanding-of-closure-in-javascript">StackOverflow</a>, эта оптимизация уже есть в Firefox 18.</p>
</div>
      <div class="post-head group"><a href="/blog/posts/chrome-consolelog.html">
          <h1 class="post-title">Chrome console.log bullshit explained</h1></a>
        <h2 class="post-date">2013 &#183; 8 &#183; 6</h2>
      </div>
      <div class="post-body"><p>Несколько раз сталкивался с тем, что <code>console.log(var)</code> в Chrome DevTools показывает что-то странное. Что-то вроде:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">];</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>выдает не</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</code></pre>
<p>а</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="mi">3</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</code></pre>
<p>Память подсказывает, что происходит это из-за того, что <code>console.log</code> работает асинхронно, объекты в него передаются по ссылке.</p>
<p>Сегодня опять зашла речь об этом поведении, и, немного поискав и пройдя через несколько десятков дубликатов, удалось найти соответствующую задачу в трэкере Chrome:
<a href="https://code.google.com/p/chromium/issues/detail?id=50316">Issue 50316:   Console.log gives incorrect output in Chrome Developer Tools console</a></p>
<p>Задача была закрыта в августе 2012 года, причем с некоторыми особенностями (<a href="https://code.google.com/p/chromium/issues/detail?id=50316#c30">#30</a>):
<strong>при открытом DevTools</strong> Chrome создает «мгновенный снимок» объекта на момент логгирования, который включает в себя 5 свойств для объекта и 100 элементов для массива, этот снимок рендерится с примененнием наклонного шрифта. При попадании в лог сложных объектов (напр. <code>window</code>), Chrome отрисует снимок наклонным шрифтом, но при открытии сложного объекта будет показано его состояние на момент открытия его в консоли, а не на момент логгирования (<a href="https://chromium.googlecode.com/issues/attachment?aid=503160030001&amp;name=Screen+shot+2012-08-10+at+11.10.42+AM.png&amp;token=1khKL6wDKondsPabqyr0ANcTW_g%3A1375775441107&amp;inline=1&amp;thumb=1">картинка в трэкере</a>).</p>
<p>При закрытом DevTools сохраняется старое, не всегда ожидаемое, поведение.</p>
</div>
    </div><a href="http://colinwren.github.io/Cabin/"><img src="/images/cabin.png" class="cabin"></a>
    <script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter21700567 = new Ya.Metrika({id:21700567, clickmap:true, trackLinks:true, accurateTrackBounce:true}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script>
    <noscript>
      <div><img src="//mc.yandex.ru/watch/21700567" style="position:absolute; left:-9999px;" alt=""></div>
    </noscript>
  </body>
</html>